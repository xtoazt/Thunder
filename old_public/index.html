<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="title" content="Thundr" />
  <meta name="description" content="The better way to browse." />
  <link rel="icon" type="image/x-icon" href="assets/imgs/logo.png" />
  <title>Thundr</title>
  <!-- Critical CSS -->
  <link rel="stylesheet" href="assets/css/global.css" />
  <link rel="stylesheet" href="assets/css/theme/default.css" />
  <!-- Non-critical CSS -->
  <link rel="stylesheet" href="assets/css/rays.css" />
  <link rel="stylesheet" href="assets/css/nav.css" />
  <link rel="stylesheet" href="assets/css/elements/news.css" />
  <link rel="stylesheet" href="assets/css/searchbar.css" />
  <link rel="stylesheet" href="assets/css/shortcuts.css" />
  <link rel="stylesheet" href="assets/css/elements/greeting.css" />
  <link rel="stylesheet" href="assets/css/elements/ping.css" />
</head>

<body>
  <div class="container">
    <div class="raysContain">
      <div class="rays"></div>
    </div>
    <nav>
      <img src="assets/imgs/logo.png" alt="logo" />
      <div class="flex">
        <a href="/">Home</a>
        <a href="/g">Games</a>
        <a href="/a">Apps</a>
        <a href="/ai">AI</a>
        <a href="/settings">Settings</a>
      </div>
    </nav>
    <div class="news animate-fadeInUp animate-delay-1"
      style="border-left:3px solid var(--accent); padding-left:10px; display:none;">
      <p></p>
    </div>
    <h1 class="title animate-fadeInUp">Thundr</h1>
    <div class="searchbarContainer animate-fadeInUp animate-delay-2">
      <i data-lucide="search"></i>
      <form id="uv-form">
        <input class="searchbar" id="searchbar" type="text" required />
      </form>
    </div>
    <div class="shortcutsContain animate-fadeInUp animate-delay-3" id="shortcutsContain"></div>
    <div id="greeting"></div>
    <div class="pingCounter">
      <div id="pingDot" class="dot"></div>
      <span id="pingValue"></span>
    </div>
    <footer>
      <a href="https://github.com/xnoctra/Thundr" target="_blank">GitHub</a>
      <span>\</span>
      <a href="https://discord.gg/5hETqnGc3e">Discord</a>
      <span>\</span>
      <span>Credits: built by rohan</span>
    </footer>
  </div>
  <script src="assets/js/index.js"></script>
  <script src="assets/js/shortcuts.js"></script>
  <script src="assets/js/elements/greeting.js"></script>
  <script src="assets/js/elements/ping.js"></script>
  <!-- UV Files -->
  <script src="/search/bundle.js"></script>
  <script src="/search/config.js"></script>
  <!-- DO NOT REMOVE -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .upgrade-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
    }

    .upgrade-card {
      width: min(520px, 92vw);
      border: 1px solid #23262f;
      border-radius: 12px;
      background: #0b0d12;
      color: #e5e7eb;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      padding: 18px;
    }

    .upgrade-card h3 {
      margin: 0 0 8px 0;
      font-size: 20px;
    }

    .upgrade-card p {
      margin: 0 0 12px 0;
      color: #b3b8c5;
    }

    .upgrade-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .btn {
      background: #111318;
      border: 1px solid #23262f;
      color: #e5e7eb;
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
    }

    .btn.primary {
      background: var(--accent, #b578ff);
      border-color: transparent;
      color: #0b0d12;
    }
  </style>
  <div id="upgrade-overlay" class="upgrade-overlay">
    <div class="upgrade-card">
      <h3>Thundr just got an upgrade!</h3>
      <p>Hundreds of new games, and a brand new UI.</p>
      <div class="upgrade-actions">
        <button id="upgrade-close" class="btn">Close</button>
        <a href="/g" id="upgrade-go" class="btn primary">Browse Games</a>
      </div>
    </div>
  </div>
  <script>
    lucide.createIcons();
  </script>
  <!-- DO NOT REMOVE -->
  <script>
    // First-visit popup (onscreen)
    try {
      const ov = document.getElementById('upgrade-overlay');
      const closeBtn = document.getElementById('upgrade-close');
      const show = () => { ov.style.display = 'flex'; };
      const hide = () => { ov.style.display = 'none'; };
      if (!localStorage.getItem('thundr:firstvisit')) {
        show();
        closeBtn?.addEventListener('click', () => { localStorage.setItem('thundr:firstvisit', '1'); hide(); });
        document.getElementById('upgrade-go')?.addEventListener('click', () => { localStorage.setItem('thundr:firstvisit', '1'); });
        ov?.addEventListener('click', (e) => { if (e.target === ov) { localStorage.setItem('thundr:firstvisit', '1'); hide(); } });
      }
    } catch { }

    const form = document.getElementById('uv-form');
    const address = document.getElementById('searchbar');
    const searchEngine = document.getElementById('uv-search-engine');
    const error = document.getElementById('uv-error');
    const errorCode = document.getElementById('uv-error-code');
    const input = document.querySelector('input');

    // crypts class definition
    class crypts {
      static encode(str) {
        return encodeURIComponent(
          str
            .toString()
            .split('')
            .map((char, ind) => (ind % 2 ? String.fromCharCode(char.charCodeAt() ^ 2) : char))
            .join('')
        );
      }

      static decode(str) {
        if (str.charAt(str.length - 1) === '/') {
          str = str.slice(0, -1);
        }
        return decodeURIComponent(
          str
            .split('')
            .map((char, ind) => (ind % 2 ? String.fromCharCode(char.charCodeAt() ^ 2) : char))
            .join('')
        );
      }
    }

    function search(input) {
      input = input.trim();
      const searchTemplate = localStorage.getItem('engine') || 'https://www.bing.com/search?q=%s';

      try {
        return new URL(input).toString();
      } catch (err) {
        try {
          const url = new URL(`http://${input}`);
          if (url.hostname.includes('.')) {
            return url.toString();
          }
          throw new Error('Invalid hostname');
        } catch (err) {
          return searchTemplate.replace('%s', encodeURIComponent(input));
        }
      }
    }
    if ('serviceWorker' in navigator) {
      var proxySetting = 'uv';
      let swConfig = {
        uv: { file: '/search/sw.js', config: __uv$config },
      };

      let { file: swFile, config: swConfigSettings } = swConfig[proxySetting];

      navigator.serviceWorker
        .register(swFile, { scope: swConfigSettings.prefix })
        .then((registration) => {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
          // Apply simple customisation
          try {
            const accent = localStorage.getItem('ui:accent');
            if (accent) document.documentElement.style.setProperty('--accent', accent);
            const title = localStorage.getItem('ui:title');
            if (title) document.title = title;
          } catch { }
          form.addEventListener('submit', async (event) => {
            event.preventDefault();
            let encodedUrl = swConfigSettings.prefix + crypts.encode(search(address.value));
            sessionStorage.setItem('encodedUrl', encodedUrl);
            location.href = '/search';
          });
        })
        .catch((error) => {
          console.error('ServiceWorker registration failed:', error);
        });
    }
  </script>
</body>

</html>